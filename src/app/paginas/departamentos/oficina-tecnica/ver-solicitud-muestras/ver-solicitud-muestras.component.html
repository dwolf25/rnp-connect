<div class="container mt-5">
  <h2 class="mb-4">Ver Solicitudes de Muestra</h2>

  <!-- Tabla de Solicitudes -->
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Solicitante</th>
          <th>Nombre MP</th>
          <th>Lote</th>
          <th>Proveedor</th>
          <th>Urgencia</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let solicitud of solicitudes">
          <td>{{ solicitud.solicitante }}</td>
          <td>{{ solicitud.nombreMp }}</td>
          <td>{{ solicitud.lote }}</td>
          <td>{{ solicitud.proveedor }}</td>
          <td>{{ solicitud.urgencia }}</td>
          <td>{{ solicitud.fecha | date }}</td>
          <td>{{ solicitud.estado }}</td>
          <td>
            <!-- Botón para abrir el modal -->
            <button
              class="btn btn-info btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#detalleModal"
              (click)="cargarDetalles(solicitud)"
            >
              Ver
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal para Ver Detalles -->
  <div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-xl">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h5 class="modal-title" id="detalleModalLabel">Detalles de la Solicitud</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <!-- Modal Body -->
        <div class="modal-body">
          <div class="row">
            <!-- Panel izquierdo: Detalles de la Solicitud -->
            <div class="col-md-6 details-panel">
              <h6>Detalles de la Solicitud</h6>
              <p><strong>Solicitante:</strong> {{ solicitudSeleccionada?.solicitante }}</p>
              <p><strong>Nombre del MP:</strong> {{ solicitudSeleccionada?.nombreMp }}</p>
              <p><strong>Lote:</strong> {{ solicitudSeleccionada?.lote }}</p>
              <p><strong>Proveedor:</strong> {{ solicitudSeleccionada?.proveedor }}</p>
              <p><strong>Urgencia:</strong> {{ solicitudSeleccionada?.urgencia }}</p>
              <p><strong>Fecha:</strong> {{ solicitudSeleccionada?.fecha | date }}</p>
              <p><strong>Estado:</strong> {{ solicitudSeleccionada?.estado }}</p>
              <p><strong>Código Artículo:</strong> {{ solicitudSeleccionada?.codigoArticulo }}</p>
              <p><strong>Comentarios:</strong> {{ solicitudSeleccionada?.comentarios }}</p>

            </div>




            <!-- Panel derecho: Conversación -->
            <div class="col-md-6 chat-panel">
              <h6>Conversación</h6>
              <div class="chat-container" #chatContainer>
                <div *ngIf="mensajes.length === 0" class="text-center">No hay mensajes.</div>
                <div *ngFor="let mensaje of mensajes" class="chat-message"
                     [ngClass]="{
                       'message-sent': mensaje.remitente === obtenerNombreToken(),
                       'message-received': mensaje.remitente !== obtenerNombreToken()
                     }">
                  <p><strong>{{ mensaje.remitente }}:</strong></p>
                  <p>{{ mensaje.contenido }}</p>
                  <small class="text-muted">{{ mensaje.fecha | date:'short' }}</small>
                </div>
              </div>
              <div class="col-md-12 mt-3">


</div>
              <div class="mt-3">
                <textarea class="form-control" [(ngModel)]="nuevoMensaje" rows="3" placeholder="Escribe tu mensaje aquí..."></textarea>
                <button class="btn btn-primary mt-2" (click)="enviarMensaje()" [disabled]="!nuevoMensaje.trim()">Enviar</button>
              </div>
              <div class="col-md-12 mt-3">
             <!-- ver-solicitud-muestras.component.html -->


                </div>
              </div>



          </div>
        </div>
        <!-- Modal Footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>
